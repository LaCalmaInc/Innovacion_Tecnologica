<!DOCTYPE html>
<!-- saved from url=(0050)https://casino.usm.cl/solicitud/MisSolicitudesMenu -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="./MisReservas_files/bootstrap.min.css">
        <link href="./MisReservas_files/estilo.css" rel="stylesheet" type="text/css">
        <link href="./MisReservas_files/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css">
        <link href="./MisReservas_files/daterangepicker.css" rel="stylesheet" type="text/css">
        <link href="./MisReservas_files/all.css" rel="stylesheet" type="text/css">
        <link href="./MisReservas_files/datatables.min.css" rel="stylesheet" type="text/css">
        <link href="./MisReservas_files/select2.min.css" rel="stylesheet" type="text/css">
        <title>Casino de Alimentación</title>
        <style>
            label i {
                display: none !important;
            }
            label:hover i {
                display: inline-block !important;
            }
            label i:hover{
                cursor: help
            }
            table.dataTable thead th, table.dataTable thead td{
                     border-bottom: 0px ;
                
            }
        </style>
    <style type="text/css" id="operaUserStyle"></style></head>
    <script>
  window.addEventListener("DOMContentLoaded", () => {
    const name = localStorage.getItem("userName");
    if (!name) {
      // si no hay sesión activa
      window.location.href = "login.html";
      return;
    }
    // Actualizar TODOS los spans de usuario
    document
      .querySelectorAll(".link-top-bar.single-link.external")
      .forEach(el => el.textContent = name);
  });
</script>
    <body class="body-usm">   
        <a  style="display: none" id="volver">aqui</a>
               



<link rel="stylesheet" href="./MisReservas_files/normalize.css">
<link rel="stylesheet" href="./MisReservas_files/usm-estilo.css">
<link href="./MisReservas_files/css2" rel="stylesheet">
<header id="header" class="container-fluid">
    <div class="row top-bar">
        <div class="container">
            <div class="row justify-content-between">
                <div class="col-4 ocultar-mobile">
                    <ul class="breadcrumbs">
                        <li>
                            <a > USM.cl</a>
                        </li>
                    </ul>
                </div>
                <div class="col-sm-12 col-md-8 text-right">
                    <ul class="top-bar-menu">
                        <li class="nav-item dropdown   usm-menus ">
                            <a class="nav-link dropdown-toggle link-top-bar"  data-toggle="dropdown" id="dp-categorias2" aria-expanded="false">Minuta</a>
                            <ul class="dropdown-menu fade-up" aria-labelledby="dp-categorias2" style="">                    
                                <li><a target="_blank" class="dropdown-item">Casa Central Valparaíso</a></li>
                                <li><a target="_blank" class="dropdown-item">Vitacura</a></li>
                                <li><a target="_blank" class="dropdown-item">Vińa del Mar</a></li>
                                <li><a target="_blank" class="dropdown-item">Concepción</a></li>
                                <li><a target="_blank" class="dropdown-item">San Joaquín</a></li>
                            </ul>
                        </li>
                        
                        <li>
                            <span class="link-top-bar single-link external">Usuario</span>
                        </li>
                        <li>
                            <a class="link-top-bar single-link" href="Homepage.html">Cerrar sesión</a>
                        </li>              
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="row wrap-menu">
        <div class="container">
            <div class="row justify-content-between align-items-center">
                <div class="col-md-3 logo-usm">
                    <a [routerlink]="[&#39;/&#39;]" class="brand-link">
                        <img src="./MisReservas_files/logo-usm.svg" alt="Universidad Técnica Federico Santa María">
                    </a>
                </div>
                <div class="col-md-3 text-right">
                </div>
            </div>
        </div>
    </div>
    <div class="row wrap-menu-mobile">
        <div class="container">
            <div class="row justify-content-between align-items-center" style="padding-left: .65rem">
                <div class="col-6 col-sm-6 col-md-5 col-lg-4">
                    <a [routerlink]="[&#39;/&#39;]" class="brand-link">
                        <img src="./MisReservas_files/logo-usm.svg" alt="Universidad Técnica Federico Santa María">
                    </a>
               </div>
                <div class="col-4 col-md-3 col-sm-6 text-right">
                    <a  class="wrap-icon-menu toggle-menu">
                        <i class="fas fa-bars"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="container-fluid wrap-items-menu-mobile" style="display: block;">
            <div class="row" id="collapseMain">
                <div class="navbar-menu-mobile blue-menu" style="padding-left: .65rem">
                    
                    <a href="ReservaDeMenu.html" class="item-navbar-mobile">Reserva de menú</a>
                    <a href="MisReservas.html" class="item-navbar-mobile">Mis reservas</a>
                    <a href="MisConsumos.html" class="item-navbar-mobile">Mis consumos</a>
                    <a href="ComprarAlmuerzos.html" class="item-navbar-mobile">Comprar almuerzos</a>
                    <a href="ProgramacionMenu.html" class="item-navbar-mobile">Programación Menú</a>
                    <a href="CajaComentarios.html" class="item-navbar-mobile">Caja de Comentarios</a>
                    
                    
                    
                <div class="wrap-collapse-mobile">
                    <a  class="item-navbar-mobile collapsed" data-toggle="collapse" aria-controls="collapseColacion" aria-expanded="false">Minuta<i class="fas fa-angle-down"></i></a>
                        <div class="collapse-items-mobile collapse" id="collapseMinuta" data-parent="#collapseMain" style="">      
                            <div class="navbar-menu-mobile">                 
                                <a  target="_blank" class="item-navbar-mobile">Casa Central Valparaíso</a>
                                <a  target="_blank" class="item-navbar-mobile">Vitacura</a>
                                <a target="_blank" class="item-navbar-mobile">Vińa del Mar</a>
                                <a target="_blank" class="item-navbar-mobile">Concepción</a>
                                <a target="_blank" class="item-navbar-mobile">San Joaquín</a>
                            </div>
                        </div>    
                    
                </div>

                 
                </div>
            </div>
        </div>
    </div>
</header>
<div class="container">
    
    <div class="form-group row justify-content-center mt-3 text-center">
        <div class="col">
            
            <main>
                <ul class="nav nav-tabs tabs-superior ocultar-tab-mobile" id="tabs-superior ">
                    
                    <li class="nav-item">
                        <a href="ReservaDeMenu.html" class="nav-link ">Reserva de menú</a>  
                    </li>
                    <li class="nav-item">
                        <a href="MisReservas.html" class="nav-link  active ">Mis reservas</a>
                    </li>
                    <li class="nav-item">
                        <a href="MisConsumos.html" class="nav-link ">Mis consumos</a>
                    </li>
                    <li class="nav-item">
                        <a href="ComprarAlmuerzos.html" class="nav-link ">Comprar almuerzos</a>
                    </li>
                    <li class="nav-item">
                        <a href="ProgramacionMenu.html" class="nav-link">Programación Menú</a>
                    </li>
                    <li class="nav-item">
                        <a href="CajaComentarios.html" class="nav-link">Caja de Comentarios</a>
                    </li>
                </ul>
            </main>
        <div class="">
            <div class="card">
              <!--  <div class="card-header">
                    <h2 class="titulo">
                        <small class="text-center">                            
                            Anulación de almuerzo           
                        </small>
                    </h2>
                </div>-->
                <div class="card-body">                        
                        <div id="alertFecha" class="form-group row mt-3 justify-content-center"> 
                             
                            <div class="col-md-2 col-sm-12">
                                
                                <div class="row justify-content-center">
                                    <div class="col-15">
                                        <h5>Disponibles</h5>
                                    </div>
                                </div>
                                
                                <div class="row justify-content-center">
                                    <!--<div class="col-auto">
                                        <div class="border rounded-circle bg-info text-white" style="width: 75px;height: 75px;padding-top: 50%; border-color: #bee5eb!important;background-color: #d1ecf1!important; "  > 
                                            <p style="  transform: translateY(-50%); font-size: 30px;color: #0c5460;"> 
                                                <strong>6</strong>
                                            </p>
                                        </div>
                                    </div>-->
                                    <div class="panel-heading">
                                        <button type="button" class="alert alert-info btn-circle btn-xl card-effect__usm">
                                            <small>Almuerzos</small><br><strong><span id="almuerzosBtn">...</span></strong>
                                        </button>
                                        <button type="button" class="alert alert-info btn-circle btn-xl card-effect__usm">
                                            <small>Cenas</small><br><strong><span id="cenasBtn">...</span></strong>
                                        </button>
                                    </div>
                                    
                                </div>
                                <br>       
                            </div>                       
                            <div class="col-1 d-sm-none d-md-inline "></div>
                            
                            <div class="alert alert-info alert-dismissible fade col-md-8 col-sm-12 show text-left" role="alert">                                
                                <strong>Información</strong><br>
                                <strong>-</strong> El plazo para anular una reserva, es hasta las 16:00 horas del día anterior a su consumo, si la reserva tiene días consumidos, la fecha de término será actualizada.<br>
                                <strong>-</strong> Si anula una reserva, puede volver a generarla en pestaña reserva de menú.
                            </div> 
                        </div>
                        <div class="form-group  row mt-3 justify-content-center">
                          <!--  <div class="col-sm-10 col-md-8 mb-2">
                                <div class="row">                                    
                                   
                                    <div class="col-auto">                                                
                                        <div class="alert alert-primary " role="alert">
                                            Con reserva anterior
                                        </div>
                                    </div>
                                    <div class="col-auto">                                                
                                        <div class="alert alert-warning " role="alert">
                                            Sin Aforo disponible 
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>-->
                            <div class="col-sm-12 col-md-12 mb-12" style="overflow-x: scroll">
                                <div id="fechas_wrapper" class="dataTables_wrapper no-footer"><table class="table table-bordered dataTable no-footer" id="fechas" role="grid" aria-describedby="fechas_info" style="width: 1146px;">
                                    <thead>
                                        <tr role="row"><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Acción : activate to sort column ascending" style="width: 72px;"> Acción </th><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Fecha registro : activate to sort column ascending" style="width: 142px;"> Fecha registro </th><th class="sorting_desc" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-sort="descending" aria-label=" Código reserva : activate to sort column ascending" style="width: 148px;"> Código reserva </th><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Fecha desde : activate to sort column ascending" style="width: 126px;"> Fecha desde </th><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Fecha hasta : activate to sort column ascending" style="width: 121px;"> Fecha hasta </th><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Menú : activate to sort column ascending" style="width: 61px;"> Menú </th><th class="sorting" tabindex="0" aria-controls="fechas" rowspan="1" colspan="1" aria-label=" Campus/Sede reserva : activate to sort column ascending" style="width: 210px;"> Campus/Sede reserva </th></tr>
                                    </thead>
                                    <tbody>
                                    <tr class="odd"><td valign="top" colspan="7" class="dataTables_empty">No existen solicitudes</td></tr></tbody>
                                </table><div class="dataTables_info" id="fechas_info" role="status" aria-live="polite"></div></div>
                            </div>
                        </div>                        
                        
                    </div>
                    <script>
                        async function cargarStockEnBotones() {
                            try {
                                const res = await fetch("stock.json");
                                const data = await res.json();
                    
                                // Obtener la cantidad de almuerzos desde localStorage
                                let almuerzosEnLocalStorage = localStorage.getItem("almuerzosComprados");
                                almuerzosEnLocalStorage = almuerzosEnLocalStorage ? parseInt(almuerzosEnLocalStorage) : 0;
                                console.log(almuerzosEnLocalStorage, data);
                                // Calcular el total de almuerzos
                                const totalAlmuerzos = data.almuerzos + almuerzosEnLocalStorage;
                    
                                // Actualizar el contenido de los botones con el total
                                document.getElementById("almuerzosBtn").textContent = totalAlmuerzos;
                                document.getElementById("cenasBtn").textContent = data.cenas;
                            } catch (error) {
                                console.error("Error cargando stock:", error);
                                document.getElementById("almuerzosBtn").textContent = "N/D";
                                document.getElementById("cenasBtn").textContent = "N/D";
                            }
                        }
                    
                        // Ejecutar al cargar la página
                        window.addEventListener("DOMContentLoaded", () => {
                            cargarStockEnBotones();
                        });
                    </script>
                </div>      
            </div>
        </div>
        <div class="modal fade" data-keyboard="false" data-backdrop="static" id="informacionBloqueadaGeneral" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="TitleInformcacionBloqueadaGeneral">Modal title</h5>
                    </div>
                    <div class="modal-body" id="contenidoInformacionBloqueadaGeneral">

                    </div>
                    <div class="modal-footer" id="footerInformacionBloqueadaGeneral">

                    </div>
                </div> 
            </div>
        </div>
        
        <div class="modal fade" id="informaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="informaModalTitle">Informacion</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="informaModalBody" class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-usm" data-dismiss="modal">Aceptar</button>                
                    </div>
                </div>
            </div>
        </div>
        
                   </div>
         </div>
         
         <!-- container -->
        <div class="modal fade" id="informaModalG" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="informaModalTitleG">Información</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div id="informaModalBodyG" class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-usm" data-dismiss="modal">Aceptar</button>                
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" data-keyboard="false" data-backdrop="static" id="informacionBloqueadaGeneralG" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="TitleInformcacionBloqueadaGeneralG">Modal title</h5>
                    </div>
                    <div class="modal-body" id="contenidoInformacionBloqueadaGeneralG">

                    </div>
                    <div class="modal-footer" id="footerInformacionBloqueadaGeneralG">

                    </div>
                </div> 
            </div>
        </div>
        <div id="modalCargarG" class="modal fade" data-keyboard="false" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document" style="background: none">
              <div class="modal-content " style="width: 400px; height: 400px; background: none; border: none;">
                <div class="modal-body" style="padding-top: 100px; background: none;">
                    <div class="fa-7x">
                        <i style="color: #004b85" class="fas fa-sync fa-spin">
                        </i>
                   </div>
                </div>
              </div>
            </div>
        </div>
    <footer id="footer" class="container-fluid footer-interno">
    
    <div class="row footer3 fixed-bottom">
        <div class="container">
             <p class="small fixed-p">Sitio web administrado por <a [routerlink]="[&#39;/&#39;]" class="link-white-footer external admin-titulo">Dirección General de Sistemas de Gestión</a></p>
             <!--<p class="small">Sitio web administrado por la <a href="https://usm.cl/" target="_blank" class="link-white-footer external admin-titulo">Dirección ERP</a></p>-->
        </div>
    </div>
    </footer>
        <script src="./MisReservas_files/jquery-3.5.1.min.js.descarga"></script>
        <script src="./MisReservas_files/bootstrap.bundle.min.js.descarga"></script>
        <script src="./MisReservas_files/bootstrap.min.js.descarga"></script>
        <script src="./MisReservas_files/menu.js.descarga"></script>
        <script type="text/javascript">
        function modalCargandoAbrirG(){
            $("#modalCargarG").modal("show");    
        }
        function modalCargandoCloseG(){
            $("#modalCargarG").modal("hide");    
        }
        function informaModal(titulo,mensaje){
          $("#informaModalTitleG").html(titulo);
          $("#informaModalBodyG").html(mensaje);
          if (!$("#informaModalG").hasClass("show")) {
              $("#informaModalG").modal("show");
          }
        }          
        function abrirModalBloqueadaGeneral(TituloModal, htmlForContent, htmlFooter) {
            $("#footerInformacionBloqueadaGeneralG").html("");
            $("#TitleInformcacionBloqueadaGeneralG").html("");
            $("#TitleInformcacionBloqueadaGeneralG").append(TituloModal);
            $("#contenidoInformacionBloqueadaGeneralG").html("")
            $("#contenidoInformacionBloqueadaGeneralG").append(htmlForContent);
            $("#footerInformacionBloqueadaGeneralG").html(htmlFooter);
            if (!$("#informacionBloqueadaGeneralG").hasClass("show")) {
                $("#informacionBloqueadaGeneralG").modal("show");
            }            
        }
        function cerrarModalBloqueadaGeneral() {
            
            if ($("#informacionBloqueadaGeneralG").hasClass("show")) {
                $("#informacionBloqueadaGeneralG").modal("hide");
            }            
        }
        function consultaAjaxeJson(url,propiedades,personalFuction,functionError){
                //console.log("hola 1");
                //console.log(propiedades);
                if(functionError==undefined){
                functionError=function(){};
            }
                jQuery.ajax({
                'type': 'POST',
                'url': url,
                //'contentType': 'application/x-www-form-urlencoded',
                'data': propiedades,
                        'dataType': 'text',
                        success: function(rest){
                                //console.log(rest);
                                personalFuction(rest);
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                                console.log("consultaAjaxeJson: error");
                                functionError();
                          alert(xhr.status);
                          alert(thrownError);
                        },timeout: 300000 
            });
        }
        </script>
       
        <script src="./MisReservas_files/moment.js.descarga" type="text/javascript"></script>
        <script src="./MisReservas_files/bootstrap-datepicker.js.descarga" type="text/javascript"></script>
        <script src="./MisReservas_files/daterangepicker.js.descarga" type="text/javascript"></script>        
        <script src="./MisReservas_files/datatables.min.js.descarga" type="text/javascript"></script>
        <script src="./MisReservas_files/select2.min.js.descarga" type="text/javascript"></script>
        
        <script type="text/javascript">
            
                function anularDetalle(iddetalle){
                    
                   var id = iddetalle;
                   var url ="/solicitud/ConsultasSensillas";
                   var propi ={
                       opcion:9,
                       iddetalle:id
                   };
                   cerrarModalBloqueadaGeneral();
                   consultaAjaxeJson(url, propi, function(data){
                       //console.log("data: " + data);
                       var obj = JSON.parse(data);
                       //console.log(obj);
                       if (data.anulacion == -1){
                            informaModal("Información","No fue posible anular la reserva, favor volver a intentar. ");
                            return;
                       } else {
                       modalCargandoAbrirG();
                       setTimeout(function(){modalCargandoCloseG()},500)
                       tableG.rows().remove().draw();
                       tableG.rows.add(obj.fechas).draw();
                       if (obj.cambio=='C'){
                            informaModal("Información","Reserva anulada a partir del "+ obj.fechaMensaje +".");
                       } else {
                            informaModal("Información","Reserva anulada correctamente.");
                       }
                       }}, function(error){
                            console.log(error);
                   });
                } 
                $(document).on("click",".anular",function(){
                    var id = $(this).data("key");
                    var footer = '<input type="button" class="btn btn-usm" value="Si" onclick="anularDetalle('+id+')" /><input class="btn btn-usm" type="button" value="No" onclick="cerrarModalBloqueadaGeneral()"/>';
                    abrirModalBloqueadaGeneral("Información","¿Está seguro de anular la reserva seleccionada?",footer);
                    
                });
                var tableG= $("#fechas").DataTable({
                            "language": {
                                "info": " ",
                                "emptyTable": "No existen solicitudes",
                                "infoEmpty": ""
                            },data:[] ,
                            "drawCallback": function( settings ) {
                               //$("#turno").trigger("change");
                           },
                            createdRow: function (row, data, dataIndex) {                               

                            },
                            columns: [{
                                    render: function (data, type, row, meta) {
                                        var disable ="";
                                        if(row.deshab=="true"){
                                            disable = 'disabled="true" style="cursor: no-drop;"';
                                        }
                                        return '<input type="button" '+disable+' class="btn btn-usm anular" value="Anular" data-key="'+row.codDet+'" />';
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.registro;
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.codDet;
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.desde;
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.hasta;
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.menu;
                                    }
                                },{
                                    render: function (data, type, row, meta) {

                                        return row.sede;
                                    }
                                }
                            ],

                            paging: false,
                            "searching": false,
                            "order": [[ 2, "desc" ]],
                            responsive: true
                    });
        </script>
    

</body></html>